(function(e,t){var n=function(e){return e!==undefined&&e!=null};var r=false;if(e.XMLHttpRequest){var i=new XMLHttpRequest;r=n(i.upload)}t.extend(t.support,{fileSelecting:n(e.File)&&n(e.FileList),fileReading:n(e.FileReader),fileSending:n(e.FormData),uploadControl:r});var s=function(e,t){e=parseInt(e);t=t||"";if(e==0||isNaN(e)){return t}var n=String.fromCharCode(Math.floor(Math.random()*26)+97);return t+n+s(--e)};var o=function(e){return e instanceof File||e instanceof Blob};var u=function(t,n){if(e.Blob){return new Blob([t],{type:n})}var r=e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder||e.BlobBuilder;return r?(new r).append(ab).getBlob(n):null};var a=function(e){return e.substr(0,5)=="data:"};var f=function(e){e=n(e.toString)?e.toString():""+e;var t="text/plain";if(a(e)){var r=e.split(",");var i=r[0].indexOf("base64")>=0?atob(r[1]):unescape(r[1]);t=r[0].split(":")[1].split(";")[0];e=new ArrayBuffer(i.length);var s=new Uint8Array(e);for(var o=0;o<i.length;o++){s[o]=i.charCodeAt(o)}}return u(e,t)};t.fn.damnUploader=function(e){if(this.length==0){return this}else if(this.length>1){return this.each(function(){t(this).damnUploader(e)})}var r=this;r._duSettings=t.extend({url:"/upload.php",multiple:true,fieldName:"file",dropping:true,dropBox:false,limit:false,dataType:"text"},e||{});!r._duSettings.multiple&&(r._duSettings.limit=1);var i=function(e,t,n){this.file=e;this.fieldName=null;this.replaceName=null;this.progressCallback=n;this.completeCallback=t;this.xhr=null;this.cancelled=false;this.started=false;this.completed=false;this._id=s(7);this._post=[]};t.extend(i.prototype,{id:function(){return this._id},addPostData:function(e,n){var r=this;if(t.isArray(e)){t.each(e,function(e,t){r.addPostData(t.name,t.value)});return}this._post.push({name:e,value:n})},upload:function(){r._duUploadItem(this)},cancel:function(){r.duCancel(this._id)},getReaderCallback:function(e){var n;if(t.support.fileReading){n=new FileReader;n.onload=e}return n},readAs:function(e,t){var n="readAs"+e;var r=this.getReaderCallback(t);r&&r[n]&&r[n].call(r,this.file)}});r._duQueue={};r._duItemsCount=0;var u=r._duQueue;var a=r._duSettings;r._duAddItemsToQueue=function(e){var n=t.Event("du.add");var i=t.Event("du.limit");var s;if(r._duItemsCount===a.limit){r.trigger(i);return false}if(e instanceof FileList){var o=[];t.each(e,function(e,t){o.push(r._duAddItemsToQueue(t))});return o}else if((s=r.duNewUploadItem(e))===false){return false}n.uploadItem=s;r.trigger(n);if(n.isDefaultPrevented()){return false}var f=s.id();r._duItemsCount++;u[f]=s;return s};r._duUploadItem=function(e){if(!t.support.fileSending||!o(e.file)){return false}if(e.started){return}e.started=true;var n=new XMLHttpRequest;var r=0;var i=false;var s=t.isFunction(e.progressCallback);if(n.upload){n.upload.addEventListener("progress",function(t){if(t.lengthComputable){r=t.loaded*100/t.total;s&&e.progressCallback.call(e,Math.round(r))}},false);n.upload.addEventListener("load",function(e){r=100;i=true},false)}else{i=true}n.onreadystatechange=function(){var n=t.isFunction(e.completeCallback);if(this.readyState==4){e.completed=true;if(this.status<400){if(!i){n&&e.completeCallback.call(e,false,null,0)}else{t.isFunction(e.progressCallback)&&e.progressCallback.call(e,100);var r=a.dataType=="json"?t.parseJSON(this.responseText):this.responseText;n&&e.completeCallback.call(e,true,r)}}else{n&&e.completeCallback.call(e,false,null,this.status)}}};var u=e.replaceName||e.file.name;n.open("POST",a.url);var f=new FormData;f.append(e.fieldName||a.fieldName||"file",e.file,u);if(e._post.length>0){t.each(e._post,function(e,t){f.append(t.name,t.value)})}n.send(f);e.xhr=n};var l=r.get(0).tagName=="INPUT"&&this.attr("type")=="file";if(l){r.prop("multiple",a.multiple).on("change",function(){r._duAddItemsToQueue(this.files)})}if(a.dropping){r.on("drop",function(e){r._duAddItemsToQueue(e.originalEvent.dataTransfer.files);return false});a.dropBox&&t(a.dropBox).on("drop",function(e){r._duAddItemsToQueue(e.originalEvent.dataTransfer.files);return false})}r.duStart=function(){if(!a.url){return r}t.each(u,function(e,n){var i=n.completeCallback;n.completeCallback=function(n,s,o){if(!this.cancelled){delete u[e];r._duItemsCount--}if(t.isFunction(i)){i.call(this,n,s,o)}if(r._duItemsCount==0){r.trigger("du.completed")}};r._duUploadItem(n)});return r};r.duCancel=function(e){if(e&&r._duItemsCount>0){if(n(u[e])){if(u[e].xhr){u[e].cancelled=true;u[e].xhr.abort()}delete u[e];r._duItemsCount--}}return r};r.duCancelAll=function(){l&&r.val("");t.each(u,function(e,t){r.duCancel(e)});return r};r.duNewUploadItem=function(e){switch(true){case e instanceof i:return e;case o(e):return new i(e);default:var t=f(e);return t!==false?r.duNewUploadItem(t):false}};r.duEnqueue=function(e){return r._duAddItemsToQueue(e)};r.duGetQueue=function(){return r._duQueue};r.duCount=function(){return r._duItemsCount};r.duOption=function(e,n){var i=["url","fieldName","limit","dataType"];if(t.isPlainObject(e)){t.each(e,function(e,t){r.duOption(e,t)})}else if(n===undefined){return r._duSettings[e]}else{t.inArray(e,i)&&(r._duSettings[e]=n)}return r};return r}})(window,window.jQuery)
