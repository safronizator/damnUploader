!function(e,t){var n=function(e){return void 0!==e&&null!=e},i=!1;if(e.XMLHttpRequest){var a=new XMLHttpRequest;i=n(a.upload)}t.extend(t.support,{fileSelecting:n(e.File)&&n(e.FileList),fileReading:n(e.FileReader),fileSending:n(e.FormData),uploadControl:i});var u=function(e,t){if(e=parseInt(e),t=t||"",0==e||isNaN(e))return t;var n=String.fromCharCode(Math.floor(26*Math.random())+97);return t+n+u(--e)},r=function(e){return e instanceof File||e instanceof Blob},l=function(t,n){if(e.Blob)return new Blob([t],{type:n});var i=e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder||e.BlobBuilder;return i?(new i).append(ab).getBlob(n):null},o=function(e){return"data:"==e.substr(0,5)},d=function(e){e=n(e.toString)?e.toString():""+e;var t="text/plain";if(o(e)){var i=e.split(","),a=i[0].indexOf("base64")>=0?atob(i[1]):unescape(i[1]);t=i[0].split(":")[1].split(";")[0],e=new ArrayBuffer(a.length);for(var u=new Uint8Array(e),r=0;r<a.length;r++)u[r]=a.charCodeAt(r)}return l(e,t)};t.fn.damnUploader=function(e){if(0==this.length)return this;if(this.length>1)return this.each(function(){t(this).damnUploader(e)});var i=this;i._duSettings=t.extend({url:"/upload.php",multiple:!0,fieldName:"file",dropping:!0,dropBox:!1,limit:!1,dataType:"text"},e||{}),!i._duSettings.multiple&&(i._duSettings.limit=1);var a=function(e,t,n){this.file=e,this.fieldName=null,this.replaceName=null,this.progressCallback=n,this.completeCallback=t,this.xhr=null,this.cancelled=!1,this.started=!1,this.completed=!1,this._id=u(7),this._post=[]};t.extend(a.prototype,{id:function(){return this._id},addPostData:function(e,n){var i=this;return t.isArray(e)?void t.each(e,function(e,t){i.addPostData(t.name,t.value)}):void this._post.push({name:e,value:n})},upload:function(){i._duUploadItem(this)},cancel:function(){i.duCancel(this._id)},getReaderCallback:function(e){var n;return t.support.fileReading&&(n=new FileReader,n.onload=e),n},readAs:function(e,t){var n="readAs"+e,i=this.getReaderCallback(t);i&&i[n]&&i[n].call(i,this.file)}}),i._duQueue={},i._duItemsCount=0;var l=i._duQueue,o=i._duSettings;i._duAddItemsToQueue=function(e){var n,a=t.Event("du.add"),u=t.Event("du.limit");if(i._duItemsCount===o.limit)return i.trigger(u),!1;if(e instanceof FileList){var r=[];return t.each(e,function(e,t){r.push(i._duAddItemsToQueue(t))}),r}if((n=i.duNewUploadItem(e))===!1)return!1;if(a.uploadItem=n,i.trigger(a),a.isDefaultPrevented())return!1;var d=n.id();return i._duItemsCount++,l[d]=n,n},i._duUploadItem=function(e){if(!t.support.fileSending||!r(e.file))return!1;if(!e.started){e.started=!0;var n=new XMLHttpRequest,i=0,a=!1,u=t.isFunction(e.progressCallback);n.upload?(n.upload.addEventListener("progress",function(t){t.lengthComputable&&(i=100*t.loaded/t.total,u&&e.progressCallback.call(e,Math.round(i)))},!1),n.upload.addEventListener("load",function(){i=100,a=!0},!1)):a=!0,n.onreadystatechange=function(){var n=t.isFunction(e.completeCallback);if(4==this.readyState)if(e.completed=!0,this.status<400)if(a){t.isFunction(e.progressCallback)&&e.progressCallback.call(e,100);var i="json"==o.dataType?t.parseJSON(this.responseText):this.responseText;n&&e.completeCallback.call(e,!0,i)}else n&&e.completeCallback.call(e,!1,null,0);else n&&e.completeCallback.call(e,!1,null,this.status)};var l=e.replaceName||e.file.name;n.open("POST",o.url);var d=new FormData;d.append(e.fieldName||o.fieldName||"file",e.file,l),e._post.length>0&&t.each(e._post,function(e,t){d.append(t.name,t.value)}),n.send(d),e.xhr=n}};var s="INPUT"==i.get(0).tagName&&"file"==this.attr("type");return s&&i.prop("multiple",o.multiple).on("change",function(){i._duAddItemsToQueue(this.files)}),o.dropping&&(i.on("drop",function(e){return i._duAddItemsToQueue(e.originalEvent.dataTransfer.files),!1}),o.dropBox&&t(o.dropBox).on("drop",function(e){return i._duAddItemsToQueue(e.originalEvent.dataTransfer.files),!1})),i.duStart=function(){return o.url?(t.each(l,function(e,n){var a=n.completeCallback;n.completeCallback=function(n,u,r){this.cancelled||(delete l[e],i._duItemsCount--),t.isFunction(a)&&a.call(this,n,u,r),0==i._duItemsCount&&i.trigger("du.completed")},i._duUploadItem(n)}),i):i},i.duCancel=function(e){return e&&i._duItemsCount>0&&n(l[e])&&(l[e].xhr&&(l[e].cancelled=!0,l[e].xhr.abort()),delete l[e],i._duItemsCount--),i},i.duCancelAll=function(){return s&&i.val(""),t.each(l,function(e){i.duCancel(e)}),i},i.duNewUploadItem=function(e){switch(!0){case e instanceof a:return e;case r(e):return new a(e);default:var t=d(e);return t!==!1?i.duNewUploadItem(t):!1}},i.duEnqueue=function(e){return i._duAddItemsToQueue(e)},i.duGetQueue=function(){return i._duQueue},i.duCount=function(){return i._duItemsCount},i.duOption=function(e,n){var a=["url","fieldName","limit","dataType"];if(t.isPlainObject(e))t.each(e,function(e,t){i.duOption(e,t)});else{if(void 0===n)return i._duSettings[e];t.inArray(e,a)>-1&&(i._duSettings[e]=n)}return i},i}}(window,window.jQuery);